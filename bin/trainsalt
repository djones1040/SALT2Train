#!/usr/bin/env python

from salt3.training.TrainSALT import TrainSALT
import sys, argparse, configparser, os

usagestring = """SALT3 Training

usage: python TrainSALT.py -c <configfile> <options>

config file options can be overwridden at the command line
"""

if sys.version_info < (3,0):
    sys.exit('Sorry, Python 2 is not supported')
	
salt = TrainSALT()

parser = argparse.ArgumentParser(usage=usagestring, conflict_handler="resolve")
parser.add_argument('-c','--configfile', default=None, type=str,
		    help='configuration file')
options, args = parser.parse_known_args()

if options.configfile:
    config = configparser.ConfigParser()
    if not os.path.exists(options.configfile):
        raise RuntimeError('Configfile doesn\'t exist!')
    config.read(options.configfile)
else:
    parser.print_help()
    raise RuntimeError('Configuration file must be specified at command line')

parser = salt.add_options(usage=usagestring,config=config)
options = parser.parse_args()
	
salt.options = options
salt.verbose = options.verbose
salt.clobber = options.clobber

if salt.options.stage not in ['all','validate','train']:
    raise RuntimeError('stage must be one of all, validate, train')
	
salt.main()
	
if len(salt.warnings):
    print('There were warnings!!')
    print(salt.warnings)
